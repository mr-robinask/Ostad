{% extends "base.html" %}

{% block content %}
<h2>Admin Dashboard</h2>
<hr>

<!-- Stats -->
<div class="row mb-4">
  <div class="col-md-4">
    <div class="card text-white bg-primary shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Total Donors</h5>
        <p class="card-text fs-2">{{ total_donors }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card text-dark bg-warning shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Pending Donations</h5>
        <p class="card-text fs-2">{{ pending_donations.count }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card text-white bg-danger shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Pending Requests</h5>
        <p class="card-text fs-2">{{ pending_requests.count }}</p>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Pending Actions -->
  <div class="col-md-6">
    <!-- Pending Donation Approvals -->
    <div class="card shadow-sm mb-3">
      <div class="card-header">Pending Donation Approvals</div>
      <div class="card-body">
        {% for donation in pending_donations %}
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>{{ donation.donor.username }} ({{ donation.units_donated }} units)</span>
            <div>
              <a href="{% url 'update-donation-status' donation.pk 'APPROVED' %}" class="btn btn-success btn-sm">Approve</a>
              <a href="{% url 'update-donation-status' donation.pk 'REJECTED' %}" class="btn btn-danger btn-sm">Reject</a>
            </div>
          </div>
        {% empty %}
          <p class="text-center">No pending donations.</p>
        {% endfor %}
      </div>
    </div>
    
    <!-- Pending Blood Requests -->
    <div class="card shadow-sm">
      <div class="card-header">Pending Blood Requests</div>
      <div class="card-body">
        {% for req in pending_requests %}
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>{{ req.patient_name }} ({{ req.blood_group }})</span>
            <div>
              <a href="{% url 'update-request-status' req.pk 'APPROVED' %}" class="btn btn-success btn-sm">Approve</a>
              <a href="{% url 'update-request-status' req.pk 'REJECTED' %}" class="btn btn-danger btn-sm">Reject</a>
            </div>
          </div>
        {% empty %}
          <p class="text-center">No pending blood requests.</p>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Manage Blood Requests -->
  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-header">Manage Blood Requests</div>
      <div class="card-body">
        <h5 class="mb-3">Create New Blood Request</h5>
        <form method="post">
          {% csrf_token %}
          {{ blood_request_form.as_p }}
          <button type="submit" class="btn btn-primary">Create Request</button>
        </form>
        
        <hr>

        <h5 class="mb-3">All Requests</h5>
        <form method="get" class="mb-3">
          <div class="input-group">
            <select name="blood_group" class="form-select">
              <option value="">Filter by Blood Group...</option>
              <option value="A+">A+</option>
              <option value="A-">A-</option>
              <option value="B+">B+</option>
              <option value="B-">B-</option>
              <option value="AB+">AB+</option>
              <option value="AB-">AB-</option>
              <option value="O+">O+</option>
              <option value="O-">O-</option>
            </select>
            <button class="btn btn-outline-secondary" type="submit">Filter</button>
          </div>
        </form>

        <ul class="list-group">
          {% for req in all_requests %}
            <li class="list-group-item">
              {{ req.patient_name }} ({{ req.blood_group }}) - {{ req.get_status_display }}
            </li>
          {% empty %}
            <li class="list-group-item">No requests found.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}